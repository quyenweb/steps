apiVersion: stackpulse.io/v1
kind: Step
metadata:
  version: 1.0.0
  name: "rabbitmq_nodes"
  description: "Get information about RabbitMQ nodes"
  vendor: rabbitmq
  type: hydration

envs:
  - name: USERNAME
    description: "Username"
    type: "string"
    required: true
  - name: PASSWORD
    description: "Password"
    type: "string"
    required: true
  - name: HOST
    description: "RabbitMQ host"
    type: "string"
    required: true
  - name: PORT
    description: "Host port (15672 is the common port)"
    type: "string"
    required: true
    default: "15672"
  - name: SCHEMA
    description: "Host schema (http/https)"
    type: "string"
    example: "https"
  - name: VERIFY
    description: "Should verify HTTPS or not"
    type: "bool"
    default: "true"
outputs:
  - name: output
    description: "RabbitMQ nodes array"
    type: "json"
    example: '[{"applications":[{"description":"RabbitMQ AMQP Client","name":"amqp_client","version":"3.8.2"},{"description":"The Erlang ASN1 compiler version 5.0.9","name":"asn1","version":"5.0.9"},{"description":"Erlang node failure detector","name":"aten","version":"0.5.2"},{"description":"ERTS  CXC 138 10","name":"compiler","version":"7.5"},{"description":"Small, fast, modern HTTP server.","name":"cowboy","version":"2.6.1"},{"description":"Support library for manipulating Web protocols.","name":"cowlib","version":"2.7.0"},{"description":"Helper library that obfuscates sensitive values in process state","name":"credentials_obfuscation","version":"1.1.0"},{"description":"CRYPTO","name":"crypto","version":"4.6.3"},{"description":"Ldap api","name":"eldap","version":"1.2.8"},{"description":"Generic batching server","name":"gen_batch_server","version":"0.8.2"},{"description":"Erlang event stream processor","name":"goldrush","version":"0.1.9"},{"description":"INETS  CXC 138 49","name":"inets","version":"7.1.2"},{"description":"a streaming, evented json parsing toolkit","name":"jsx","version":"2.9.0"},{"description":"ERTS  CXC 138 10","name":"kernel","version":"6.5.1"},{"description":"Erlang logging framework","name":"lager","version":"3.8.0"},{"description":"MNESIA  CXC 138 12","name":"mnesia","version":"4.16.2"},{"description":"Visualize Erlang Nodes On The Command Line","name":"observer_cli","version":"1.5.2"},{"description":"CPO  CXC 138 46","name":"os_mon","version":"2.5.1"},{"description":"Public key infrastructure","name":"public_key","version":"1.7.1"},{"description":"Raft library","name":"ra","version":"1.0.5"},{"description":"RabbitMQ","name":"rabbit","version":"3.8.2"},{"description":"Modules shared by rabbitmq-server and rabbitmq-erlang-client","name":"rabbit_common","version":"3.8.2"},{"description":"RabbitMQ LDAP Authentication Backend","name":"rabbitmq_auth_backend_ldap","version":"3.8.2"},{"description":"RabbitMQ Management Console","name":"rabbitmq_management","version":"3.8.2"},{"description":"RabbitMQ Management Agent","name":"rabbitmq_management_agent","version":"3.8.2"},{"description":"Modules shared by various peer discovery backends","name":"rabbitmq_peer_discovery_common","version":"3.8.2"},{"description":"Kubernetes-based RabbitMQ peer discovery backend","name":"rabbitmq_peer_discovery_k8s","version":"3.8.2"},{"description":"RabbitMQ Web Dispatcher","name":"rabbitmq_web_dispatch","version":"3.8.2"},{"description":"Socket acceptor pool for TCP protocols.","name":"ranch","version":"1.7.1"},{"description":"Diagnostic tools for production use","name":"recon","version":"2.5.0"},{"description":"SASL  CXC 138 11","name":"sasl","version":"3.4.1"},{"description":"Erlang/OTP SSL application","name":"ssl","version":"9.5"},{"description":"ERTS  CXC 138 10","name":"stdlib","version":"3.11"},{"description":"Tools to format paragraphs, lists and tables as plain text","name":"stdout_formatter","version":"0.2.2"},{"description":"Syntax tools","name":"syntax_tools","version":"2.2.1"},{"description":"Rate-limiting system_monitor event handler","name":"sysmon_handler","version":"1.2.0"},{"description":"DEVTOOLS  CXC 138 16","name":"tools","version":"3.3"},{"description":"XML parser","name":"xmerl","version":"1.3.23"}],"auth_mechanisms":[{"description":"QPid AMQPLAIN mechanism","enabled":true,"name":"AMQPLAIN"},{"description":"SASL PLAIN authentication mechanism","enabled":true,"name":"PLAIN"},{"description":"RabbitMQ Demo challenge-response authentication mechanism","enabled":false,"name":"RABBIT-CR-DEMO"}],"channel_closed":0,"channel_closed_details":{"rate":0},"channel_created":1,"channel_created_details":{"rate":0},"cluster_links":[],"config_files":["/opt/bitnami/rabbitmq/etc/rabbitmq/rabbitmq.conf"],"connection_closed":0,"connection_closed_details":{"rate":0},"connection_created":1,"connection_created_details":{"rate":0},"context_switches":3261943446,"context_switches_details":{"rate":69.2},"contexts":[{"cowboy_opts":"[{sendfile,false}]","description":"RabbitMQ Management","path":"/","port":"15672"}],"db_dir":"/opt/bitnami/rabbitmq/var/lib/rabbitmq/mnesia/rabbit@mu-rabbit-rabbitmq-0.mu-rabbit-rabbitmq-headless.rabbit.svc.cluster.local","disk_free":8315944960,"disk_free_alarm":false,"disk_free_details":{"rate":0},"disk_free_limit":50000000,"enabled_plugins":["rabbitmq_management","rabbitmq_peer_discovery_k8s","rabbitmq_auth_backend_ldap"],"exchange_types":[{"description":"AMQP headers exchange, as per the AMQP specification","enabled":true,"name":"headers"},{"description":"AMQP direct exchange, as per the AMQP specification","enabled":true,"name":"direct"},{"description":"AMQP fanout exchange, as per the AMQP specification","enabled":true,"name":"fanout"},{"description":"AMQP topic exchange, as per the AMQP specification","enabled":true,"name":"topic"}],"fd_total":65536,"fd_used":54,"fd_used_details":{"rate":-0.4},"gc_bytes_reclaimed":2933741002592,"gc_bytes_reclaimed_details":{"rate":272504},"gc_num":75156014,"gc_num_details":{"rate":14.6},"io_file_handle_open_attempt_avg_time":0.10286923076923077,"io_file_handle_open_attempt_avg_time_details":{"rate":0},"io_file_handle_open_attempt_count":130,"io_file_handle_open_attempt_count_details":{"rate":0},"io_read_avg_time":2.2873414634146343,"io_read_avg_time_details":{"rate":0},"io_read_bytes":44905,"io_read_bytes_details":{"rate":0},"io_read_count":41,"io_read_count_details":{"rate":0},"io_reopen_count":0,"io_reopen_count_details":{"rate":0},"io_seek_avg_time":0.035,"io_seek_avg_time_details":{"rate":0},"io_seek_count":1,"io_seek_count_details":{"rate":0},"io_sync_avg_time":0,"io_sync_avg_time_details":{"rate":0},"io_sync_count":0,"io_sync_count_details":{"rate":0},"io_write_avg_time":0.072,"io_write_avg_time_details":{"rate":0},"io_write_bytes":5,"io_write_bytes_details":{"rate":0},"io_write_count":2,"io_write_count_details":{"rate":0},"log_files":["<stdout>"],"mem_alarm":false,"mem_calculation_strategy":"rss","mem_limit":837274828,"mem_used":90701824,"mem_used_details":{"rate":-4915.2},"metrics_gc_queue_length":{"channel_closed":0,"channel_consumer_deleted":0,"connection_closed":0,"consumer_deleted":0,"exchange_deleted":0,"node_node_deleted":0,"queue_deleted":0,"vhost_deleted":0},"mnesia_disk_tx_count":21,"mnesia_disk_tx_count_details":{"rate":0},"mnesia_ram_tx_count":12,"mnesia_ram_tx_count_details":{"rate":0},"msg_store_read_count":0,"msg_store_read_count_details":{"rate":0},"msg_store_write_count":0,"msg_store_write_count_details":{"rate":0},"name":"rabbit@mu-rabbit-rabbitmq-0.mu-rabbit-rabbitmq-headless.rabbit.svc.cluster.local","net_ticktime":60,"os_pid":"167","partitions":[],"proc_total":1048576,"proc_used":550,"proc_used_details":{"rate":-0.2},"processors":2,"queue_created":1,"queue_created_details":{"rate":0},"queue_declared":1,"queue_declared_details":{"rate":0},"queue_deleted":0,"queue_deleted_details":{"rate":0},"queue_index_journal_write_count":0,"queue_index_journal_write_count_details":{"rate":0},"queue_index_read_count":20,"queue_index_read_count_details":{"rate":0},"queue_index_write_count":0,"queue_index_write_count_details":{"rate":0},"ra_open_file_metrics":{"ra_log_segment_writer":0,"ra_log_wal":1},"rates_mode":"basic","run_queue":1,"running":true,"sockets_total":58893,"sockets_used":1,"sockets_used_details":{"rate":0},"type":"disc","uptime":3150471931}]'
